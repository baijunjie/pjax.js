!function(t,e){"use strict";"object"==typeof module&&"object"==typeof exports?module.exports=e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):t.Pjax=e(t.jQuery)}(this,function(t){"use strict";function e(t){t.sort(function(t,e){return-(t.layer-e.layer)})}function n(t,e,n){x&&(f(),e?history.replaceState(t,null,n?null:t):history.pushState(t,null,n?null:t))}function i(e,n,i){if(e&&n&&i){var r=t(e),o=function(e,n){var i=c(n),r=null;return e.each(function(e,n){a(n.getAttribute("href"))||c(n.href)!==i||(r=r?r.add(n):t(n))}),r}(r,i);o&&(r.removeClass(n),o.addClass(n))}}function r(t,e,n){var i=c(e);for(var r in t)if(c(r)===i){delete t[r];break}t[e]=n}function a(t){return!t||0===t.indexOf("#")||0===t.indexOf("javascript:")}function o(t){return t&&(0===t.indexOf("http")||0===t.indexOf("file:")||0===t.indexOf("data:"))}function c(t){return t?t.replace(/#.*$/,""):location.protocol+"//"+location.host+location.pathname}function l(t,e){if(t=t.replace(/\/+$/,"")+"/",e.indexOf("../"))e.indexOf("./")?e.indexOf("/")||(t=location.protocol+"//"+location.host):e=e.replace("./","");else{var n=!1;if(e=e.replace("../",function(){return n=!0,t=t.replace(/[^\/]*\/?$/,""),""}),n)return l(t,e)}return t+e}function s(t,e){if(!A){var n=t.filter("[href],[src]").add(t.find("[href],[src]")),i=function(t){return t.replace(/[^\/]*$/,"")}(e);n.each(function(t,e){var n=e.getAttribute("href"),r=e.getAttribute("src");a(n)||o(n)||(e.href=l(i,n)),a(r)||o(r)||(e.src=l(i,r))})}}function f(){u(g,!0)}function u(t,e){var n=t.scrollTop;if(t.scrollTop+=n>0?-1:1,t.scrollTop!==n)return t.scrollTop=n,!0;if(e){var i=t.scrollLeft;return t.scrollLeft+=i>0?-1:1,t.scrollLeft!==i?(t.scrollLeft=i,!0):void 0}}function p(t){if("string"!=typeof t||-1===t.indexOf("<script"))return t;return t.replace(/<script[^>]*?>[^\x00]*?<\/script>/gi,"")}function d(n,i,r,a,o,c,l,s){var f=s.active,u=s.activeClass,d=s.update,v=s.complete,y=t.isArray(a),m=t.isArray(o),A=t.isArray(c),x=t.isArray(l),g=O++;n=t.map(n.split(","),function(e){return t.trim(e)}),i=t.map(i.split(","),function(e){return t.trim(e)}),L.pjaxOptions[g]={container:n,script:r,active:f,activeClass:u,updateCallback:d,completeCallback:v};t:for(var b,w=0;b=n[w++];){for(var S=0,k=j.updateList.length;S<k;S++)if(b===j.updateList[S].containerSelector)continue t;var q=t(b);j.updateList.push({id:g,layer:q.parents().length,$container:q.clone().html(p(q.html())),containerSelector:b})}if(e(j.updateList),j.script[g]=t(r),i.length)for(w=0,k=i.length;w<k;w++)i[w]&&C.on("click",i[w],t.proxy(h,this,y?a[w]:a,m?o[w]:o,A?c[w]:c,x?l[w]:l,s,n))}function h(t,e,i,r,o,c,l){var s=l.target,f=s.href;if(!a(s.getAttribute("href")))if(l.preventDefault(),!t&&f in L){var u=L[f];if(u===j)return;v.call(this,u,c,r),n(f,e,i)}else y.call(this,o,s,f,c,e,i,r)}function v(e,n,r){for(var a=e.updateList.length,o=[];a--;){var c=e.updateList[a],l=c.containerSelector;if(!(t.isArray(n)&&t.inArray(l,n)<0)){var s=t(l),f=c.$container.clone();if(s.length&&f.length&&s.html()!==f.html()){var u=c.id,p=L.pjaxOptions[u];p.updateCallback.call(this,s,f,e.href),(!r||t.isArray(r)&&!r[t.inArray(l,n)])&&s.empty(),f.each(function(t){f.eq(t).children().stop().css("opacity",0).appendTo(s.eq(t)).animate({opacity:1})}),p.completeCallback.call(this,s,f,e.href),o[u]=!0}}}if(o.length){e.title&&(document.title=e.title);var d={};for(a=L.pjaxOptions.length;a--;)if(o[a]){d[(p=L.pjaxOptions[a]).active+p.activeClass]||(i(p.active,p.activeClass,e.href),d[p.active+p.activeClass]=!0);var h=e.script&&e.script[a];h&&(b.append(h),h.remove())}j=e}}function y(i,a,o,c,l,f,u){var d=this;i.load.call(d,o,a),t.ajax({url:o,type:"GET",context:this,beforeSend:function(t){t.setRequestHeader("X-PJAX",!0),t.setRequestHeader("X-PJAX-Container",JSON.stringify(c))}}).done(function(h){!function(n,i){for(var a=new RegExp("<head[^>]*?>([^\0]*?)</head>","i"),o=new RegExp("<body[^>]*?>([^\0]*?)</body>","i"),c=p(a.exec(n)),l=p(o.exec(n)),f=c?t(c[1]):null,u=l?t(l[1]):null,d=f?t("<div>").append(f):null,h=u?t("<div>").append(u):null,v=L.pjaxOptions,y={},m=[],A=[],x=[],g=[],C=[],b={},O=0,j=v.length;O<j;O++){var w=v[O];w.script&&x.push(d.find(w.script).add(h.find(w.script)));for(var S,k=0;S=w.container[k++];)if(!b[S]){m.push(O),A.push(t(S).parents().length),C.push(S);var q;(q="head"===S?d:"body"===S?h:h.find(S)).length?s(q,i):q=t(S),g.push(q),b[S]=!0}}for(var E=[],R=A.length;R--;)E.push({id:m[R],layer:A[R],$container:g[R],containerSelector:C[R]});e(E),y.updateList=E,y.href=i,y.title=d.children("title").text(),y.script=x,r(L,i,y)}(h,o);var y=L[o];v.call(d,y,c,u),n(o,l,f),i.done.call(d,o,h,a)}).fail(function(){i.fail.call(d,o,a)})}function m(){this._init.apply(this,arguments)}var A,x=!!window.history.pushState,g=u(document.documentElement)?document.documentElement:document.body,C=t(document),b=t(document.body),L={},O=0,j={},w={container:"head,body",link:"",script:"",active:"",activeClass:"active",noCache:!1,noHistory:!1,noChangeURL:!1,pile:!1,noConvertPath:!1,load:function(t,e){},done:function(t,e,n){},fail:function(t,e){},update:function(t,e,n){},complete:function(t,e,n){}},S=m.prototype;return S.constructor=m,S._init=function(e){var a=t.extend({},w,e),o=a.container,c=a.link,l=a.script,u=a.noCache,p=a.noHistory,h=a.noChangeURL,y=a.pile;if(A=a.noConvertPath,!O&&(s(t(document.documentElement),location.href),j={href:location.href,title:document.title,updateList:[],script:[]},L.pjaxOptions=[],r(L,location.href,j),n(location.href,!0),x)){var m=this;window.addEventListener("popstate",function(t){var e=t.state;e&&e in L&&v.call(m,L[e]),window.setTimeout(f,0)},!1)}i(a.active,a.activeClass,location.href),o=t.isArray(o)?o:[o],c=t.isArray(c)?c:[c],l=t.isArray(l)?l:[l],u=t.isArray(u)?t.isArray(u[0])?u:[u]:u,p=t.isArray(p)?t.isArray(p[0])?p:[p]:p,h=t.isArray(h)?t.isArray(h[0])?h:[h]:h,y=t.isArray(y)?t.isArray(y[0])?t.isArray(y[0][0])?y:[y]:[[y]]:y;for(var g=t.isArray(u),C=t.isArray(p),b=t.isArray(h),S=t.isArray(y),k=0,q=o.length;k<q;k++)d.call(this,o[k],c[k],l[k],g?u[k]:u,C?p[k]:p,b?h[k]:h,S?y[k]:y,a);this.options=a},S.update=function(e){var n=(e=e||{}).href||window.location.href,i=e.container||this.options.container,r=e.noHistory,a=e.noChangeURL,o=e.pile;i&&(i=t.map(i.split(","),function(e){return t.trim(e)})),y.call(this,this.options,null,n,i,r,a,o)},m});