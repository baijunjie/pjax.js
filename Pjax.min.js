/*! Pjax v1.1.0 | @author baijunjie */
!function(t,e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):(t.bjj=t.bjj||{},t.bjj.Pjax=e(t.jQuery))}(this,function(t){"use strict";function e(t){t.sort(function(t,e){return-(t.layer-e.layer)})}function n(t,e,n){j&&(d(),e?history.replaceState(t,null,n?null:t):history.pushState(t,null,n?null:t))}function r(e,n,r){if(e&&n&&r){var a=t(e),o=i(a,r);o&&(a.removeClass(n),o.addClass(n))}}function i(e,n){var r=s(n),i=null;return e.each(function(e,n){o(n.getAttribute("href"))||s(n.href)!==r||(i=i?i.add(n):t(n))}),i}function a(t,e,n){var r=s(e);for(var i in t)if(s(i)===r){delete t[i];break}t[e]=n}function o(t){return!t||0===t.indexOf("#")||0===t.indexOf("javascript:")}function c(t){return t&&(0===t.indexOf("http")||0===t.indexOf("file:"))}function l(){return location.protocol+"//"+location.host}function s(t){return t?t.replace(/#.*$/,""):location.protocol+"//"+location.host+location.pathname}function u(t){return t.replace(/[^\/]*$/,"")}function f(t,e){if(e.indexOf("../"))e.indexOf("./")?e.indexOf("/")||(t=l()):e=e.replace("./","");else{var n=0;if(e=e.replace("../",function(){return n=1,t=t.replace(/[^\/]*\/?$/,""),""}),n)return f(t,e)}return t+e}function p(t,e){var n=t.filter("[href],[src]").add(t.find("[href],[src]")),r=u(e);n.each(function(t,e){var n=e.getAttribute("href"),i=e.getAttribute("src");o(n)||c(n)||(e.href=f(r,n)),o(i)||c(i)||(e.src=f(r,i))})}function d(){h(C,!0)}function h(t,e){var n=t.scrollTop;if(t.scrollTop+=n>0?-1:1,t.scrollTop!=n)return t.scrollTop=n,!0;if(e){var r=t.scrollLeft;return t.scrollLeft+=r>0?-1:1,t.scrollLeft!=r?(t.scrollLeft=r,!0):void 0}}function v(t){if(-1==t.indexOf("<script"))return t;var e=/<script[^\>]*?>[^\x00]*?<\/script>/gi;return t.replace(e,"")}function y(n,r){for(var i=new RegExp("<head[^>]*?>([^\x00]*?)</head>","i"),o=new RegExp("<body[^>]*?>([^\x00]*?)</body>","i"),c=v(i.exec(n)),l=v(o.exec(n)),s=c?t(c[1]):null,u=l?t(l[1]):null,f=s?t("<div>").append(s):null,d=u?t("<div>").append(u):null,h=w.pjaxOption,y={},m=[],A=[],x=[],g=[],b=[],j={},C=0,L=h.length;L>C;C++){var O=h[C];O.script&&g.push(f.find(O.script).add(d.find(O.script)));for(var S,k=0;S=O.container[k++];)if(!j[S]){m.push(C),A.push(t(S).parents().length),b.push(S);var E;E="head"===S?s:"body"===S?u:d.find(S+" >"),E.length?p(E,r):E=t(S+" >"),x.push(E),j[S]=!0}}for(var T=[],L=A.length;L--;)T.push({id:m[L],layer:A[L],$content:x[L],containerSelector:b[L]});e(T),y.updateList=T,y.href=r,y.title=f.children("title").text(),y.script=g,a(w,r,y)}function m(n,r,i,a,o,c,l,s){var u=s.active,f=s.activeClass,p=s.update,d=s.complete,h=t.isArray(a),y=t.isArray(o),m=t.isArray(c),x=t.isArray(l),g=S++;n=t.map(n.split(","),function(e){return t.trim(e)}),r=t.map(r.split(","),function(e){return t.trim(e)}),w.pjaxOption[g]={container:n,script:i,active:u,activeClass:f,updateCallback:p,completeCallback:d};t:for(var b,j=0;b=n[j++];){for(var C=0,O=k.updateList.length;O>C;C++)if(b===k.updateList[C].containerSelector)continue t;var E=t(b);k.updateList.push({id:g,layer:E.parents().length,$content:t(v(E.html())),containerSelector:b})}if(e(k.updateList),k.script[g]=t(i),r.length)for(var j=0,O=r.length;O>j;j++)L.on("click",r[j],t.proxy(A,null,h?a[j]:a,y?o[j]:o,m?c[j]:c,x?l[j]:l,s,n))}function A(t,e,r,i,a,c,l){var s=this.href;if(!o(this.getAttribute("href")))if(l.preventDefault(),!t&&s in w){var u=w[s];if(u===k)return;x(u,c,i),n(s,e,r)}else g.call(a,this,s,c,e,r,i)}function x(e,n,i){for(var a=e.updateList.length,o=[];a--;){var c=e.updateList[a],l=c.containerSelector;if(!(t.isArray(n)&&t.inArray(l,n)<0)){var s=t(l),u=s.children(),f=c.$content.clone();if(f.length&&s.length&&(f.length!==u.length||f.html()!==u.html())){var p=c.id,d=w.pjaxOption[p];d.updateCallback.call(s[0],s,f,e.href),(!i||t.isArray(i)&&!i[t.inArray(l,n)])&&s.empty(),f.stop().hide().appendTo(s).fadeIn(),d.completeCallback.call(s[0],s,f,e.href),o[p]=!0}}}if(o.length){e.title&&(document.title=e.title);var h={};for(a=w.pjaxOption.length;a--;)if(o[a]){var d=w.pjaxOption[a];h[d.active+d.activeClass]||(r(d.active,d.activeClass,e.href),h[d.active+d.activeClass]=!0);var v=e.script&&e.script[a];v&&(O.append(v),v.remove())}k=e}}function g(e,r,i,a,o,c){var l=this;l.load.call(e,r),t.ajax({url:r,type:"GET",context:this,beforeSend:function(t){t.setRequestHeader("X-PJAX",!0),t.setRequestHeader("X-PJAX-Container",JSON.stringify(i))}}).done(function(t){y(t,r);var s=w[r];x(s,i,c),n(r,a,o),l.done.call(e,r,t)}).fail(function(){l.fail.call(e,r,i)})}function b(){this._init.apply(this,arguments)}var j=!!window.history.pushState;p(t(document.documentElement),location.href);var C=h(document.documentElement)?document.documentElement:document.body,L=(t(C),t(window),t(document)),O=t(document.body),w={},S=0,k={href:location.href,title:document.title,updateList:[],script:[]};w.pjaxOption=[],a(w,location.href,k),n(location.href,!0),j&&window.addEventListener("popstate",function(t){var e=t.state;e&&e in w&&x(w[e]),window.setTimeout(d,0)},!1);var E={container:"head,body",link:"",script:"",active:"",activeClass:"active",noCache:!1,noHistory:!1,noChangeURL:!1,pile:!1,load:function(){},done:function(){},fail:function(){},update:function(){},complete:function(){}},T=b.prototype;return T.constructor=b,T._init=function(e){var n=t.extend({},E,e),i=n.container,a=n.link,o=n.script,c=n.noCache,l=n.noHistory,s=n.noChangeURL,u=n.pile;r(n.active,n.activeClass,location.href),i=t.isArray(i)?i:[i],a=t.isArray(a)?a:[a],o=t.isArray(o)?o:[o],c=t.isArray(c)?t.isArray(c[0])?c:[c]:c,l=t.isArray(l)?t.isArray(l[0])?l:[l]:l,s=t.isArray(s)?t.isArray(s[0])?s:[s]:s,u=t.isArray(u)?t.isArray(u[0])?t.isArray(u[0][0])?u:[u]:[[u]]:u;for(var f=t.isArray(c),p=t.isArray(l),d=t.isArray(s),h=t.isArray(u),v=0,y=i.length;y>v;v++)m(i[v],a[v],o[v],f?c[v]:c,p?l[v]:l,d?s[v]:s,h?u[v]:u,n);this.option=n},T.update=function(e,n,r,i,a){n=t.map(n.split(","),function(e){return t.trim(e)}),g.call(this.option,null,e,n,r,i,a)},b});
