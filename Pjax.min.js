!function(t,e){"use strict";"object"==typeof module&&"object"==typeof exports?module.exports=e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):t.Pjax=e(t.jQuery)}(this,function(t){"use strict";function e(t){t.sort(function(t,e){return-(t.layer-e.layer)})}function i(t,e,i){g&&(f(),e?history.replaceState(t,null,i?null:t):history.pushState(t,null,i?null:t))}function n(e,i,n){if(e&&i&&n){var r=t(e),o=function(e,i){var n=c(i),r=null;return e.each(function(e,i){a(i.getAttribute("href"))||c(i.href)!==n||(r=r?r.add(i):t(i))}),r}(r,n);o&&(r.removeClass(i),o.addClass(i))}}function r(t,e,i){var n=c(e);for(var r in t)if(c(r)===n){delete t[r];break}t[e]=i}function a(t){return!t||0===t.indexOf("#")||0===t.indexOf("javascript:")}function o(t){return t&&(0===t.indexOf("http")||0===t.indexOf("file:")||0===t.indexOf("data:"))}function c(t){return t?t.replace(/#.*$/,""):location.protocol+"//"+location.host+location.pathname}function l(t,e){if(t=t.replace(/\/+$/,"")+"/",e.indexOf("../"))e.indexOf("./")?e.indexOf("/")||(t=location.protocol+"//"+location.host):e=e.replace("./","");else{var i=!1;if(e=e.replace("../",function(){return i=!0,t=t.replace(/[^\/]*\/?$/,""),""}),i)return l(t,e)}return t+e}function s(t,e){if(!A){var i=t.filter("[href],[src]").add(t.find("[href],[src]")),n=function(t){return t.replace(/[^\/]*$/,"")}(e);i.each(function(t,e){var i=e.getAttribute("href"),r=e.getAttribute("src");a(i)||o(i)||(e.href=l(n,i)),a(r)||o(r)||(e.src=l(n,r))})}}function f(){u(x,!0)}function u(t,e){var i=t.scrollTop;if(t.scrollTop+=i>0?-1:1,t.scrollTop!==i)return t.scrollTop=i,!0;if(e){var n=t.scrollLeft;return t.scrollLeft+=n>0?-1:1,t.scrollLeft!==n?(t.scrollLeft=n,!0):void 0}}function p(t){if("string"!=typeof t||-1===t.indexOf("<script"))return t;return t.replace(/<script[^>]*?>[^\x00]*?<\/script>/gi,"")}function d(i,n,r,a,o,c,l,s,f){var u=f.active,d=f.activeClass,v=f.update,y=f.complete,m=t.isArray(a),A=t.isArray(o),g=t.isArray(c),x=t.isArray(l),C=t.isArray(s),j=w++;i=t.map(i.split(","),function(e){return t.trim(e)}),n=t.map(n.split(","),function(e){return t.trim(e)}),L.pjaxOptions[j]={container:i,script:r,active:u,activeClass:d,updateCallback:v,completeCallback:y};t:for(var b,T=0;b=i[T++];){for(var k=0,R=S.updateList.length;k<R;k++)if(b===S.updateList[k].containerSelector)continue t;var q=t(b);S.updateList.push({id:j,layer:q.parents().length,$container:q.clone().html(p(q.html())),containerSelector:b})}if(e(S.updateList),S.script[j]=t(r),n.length)for(T=0,R=n.length;T<R;T++)n[T]&&O.on("click",n[T],t.proxy(h,this,m?a[T]:a,A?o[T]:o,g?c[T]:c,x?l[T]:l,C?s[T]:s,f,i))}function h(t,e,n,r,o,c,l,s){var f=s.target,u=f.href;if(!a(f.getAttribute("href")))if(s.preventDefault(),!t&&u in L){var p=L[u];if(p===S)return;v.call(this,p,l,o,r,c.adjustOffset),i(u,e,n)}else y.call(this,c,f,u,l,e,n,r,o)}function v(e,i,r,a,o){for(var c=e.updateList.length,l=t(),s=[];c--;){var f=e.updateList[c],u=f.containerSelector;if(!(t.isArray(i)&&t.inArray(u,i)<0)){var p=t(u),d=f.$container.clone();if(p.length&&d.length&&p.html()!==d.html()){var h=f.id,v=L.pjaxOptions[h];v.updateCallback.call(this,p,d,e.href),(!r||t.isArray(r)&&!r[t.inArray(u,i)])&&p.empty(),d.each(function(t){d.eq(t).contents().stop().css("opacity",0).appendTo(p.eq(t)).animate({opacity:1})}),l=l.add(p),s[h]=!0}}}if(v.completeCallback.call(this,e.href),s.length){a&&function(t,e,i){if(t.length){var n,r,a=j.width()/2,o=j.height()/2,c=j.scrollLeft(),l=j.scrollTop();t.each(function(t,e){var i=this.getBoundingClientRect();(void 0===n||n>i.left)&&(n=i.left),(void 0===r||r>i.top)&&(r=i.top)}),(n>a||n<0)&&(c+=n),(r>o||r<0)&&(l+=r),C.stop().animate({scrollLeft:c-e,scrollTop:l-i})}}(l,0,o),e.title&&(document.title=e.title);var y={};for(c=L.pjaxOptions.length;c--;)if(s[c]){y[(v=L.pjaxOptions[c]).active+v.activeClass]||(n(v.active,v.activeClass,e.href),y[v.active+v.activeClass]=!0);var m=e.script&&e.script[c];m&&(b.append(m),m.remove())}S=e}}function y(n,a,o,c,l,f,u,d){var h=this;n.load.call(h,o,a),t.ajax({url:o,type:"GET",context:this,beforeSend:function(t){t.setRequestHeader("X-PJAX",!0),t.setRequestHeader("X-PJAX-Container",JSON.stringify(c))}}).done(function(y){!function(i,n){for(var a=new RegExp("<head[^>]*?>([^\0]*?)</head>","i"),o=new RegExp("<body[^>]*?>([^\0]*?)</body>","i"),c=p(a.exec(i)),l=p(o.exec(i)),f=c?t(c[1]):null,u=l?t(l[1]):null,d=f?t("<div>").append(f):null,h=u?t("<div>").append(u):null,v=L.pjaxOptions,y={},m=[],A=[],g=[],x=[],C=[],j={},O=0,b=v.length;O<b;O++){var w=v[O];w.script&&g.push(d.find(w.script).add(h.find(w.script)));for(var S,T=0;S=w.container[T++];)if(!j[S]){m.push(O),A.push(t(S).parents().length),C.push(S);var k;(k="head"===S?d:"body"===S?h:h.find(S)).length?s(k,n):k=t(S),x.push(k),j[S]=!0}}for(var R=[],q=A.length;q--;)R.push({id:m[q],layer:A[q],$container:x[q],containerSelector:C[q]});e(R),y.updateList=R,y.href=n,y.title=d.children("title").text(),y.script=g,r(L,n,y)}(y,o);var m=L[o];v.call(h,m,c,d,u,n.adjustOffset),i(o,l,f),n.done.call(h,o,y,a)}).fail(function(){n.fail.call(h,o,a)})}function m(){this._init.apply(this,arguments)}var A,g=!!window.history.pushState,x=u(document.documentElement)?document.documentElement:document.body,C=t(x),j=t(window),O=t(document),b=t(document.body),L={},w=0,S={},T={container:"head,body",link:"",script:"",active:"",activeClass:"active",noCache:!1,noHistory:!1,noChangeURL:!1,adjust:!1,pile:!1,noConvertPath:!1,adjustOffset:0,load:function(t,e){},done:function(t,e,i){},fail:function(t,e){},update:function(t,e,i){},complete:function(t){}},k=m.prototype;return k.constructor=m,k._init=function(e){var a=t.extend({},T,e),o=a.container,c=a.link,l=a.script,u=a.noCache,p=a.noHistory,h=a.noChangeURL,y=a.adjust,m=a.pile;if(A=a.noConvertPath,!w&&(s(t(document.documentElement),location.href),S={href:location.href,title:document.title,updateList:[],script:[]},L.pjaxOptions=[],r(L,location.href,S),i(location.href,!0),g)){var x=this;window.addEventListener("popstate",function(t){var e=t.state;e&&e in L&&v.call(x,L[e]),window.setTimeout(f,0)},!1)}n(a.active,a.activeClass,location.href),o=t.isArray(o)?o:[o],c=t.isArray(c)?c:[c],l=t.isArray(l)?l:[l],u=t.isArray(u)?t.isArray(u[0])?u:[u]:u,p=t.isArray(p)?t.isArray(p[0])?p:[p]:p,h=t.isArray(h)?t.isArray(h[0])?h:[h]:h,y=t.isArray(y)?t.isArray(y[0])?y:[y]:y,m=t.isArray(m)?t.isArray(m[0])?t.isArray(m[0][0])?m:[m]:[[m]]:m;for(var C=t.isArray(u),j=t.isArray(p),O=t.isArray(h),b=t.isArray(y),k=t.isArray(m),R=0,q=o.length;R<q;R++)d.call(this,o[R],c[R],l[R],C?u[R]:u,j?p[R]:p,O?h[R]:h,b?y[R]:y,k?m[R]:m,a);this.options=a},k.update=function(e){var i=(e="string"==typeof e?{href:e}:e||{}).href||window.location.href,n=e.container||this.options.container,r=e.noHistory,a=e.noChangeURL,o=e.adjust,c=e.pile;n&&(n=t.map(n.split(","),function(e){return t.trim(e)})),y.call(this,this.options,null,i,n,r,a,o,c)},m});